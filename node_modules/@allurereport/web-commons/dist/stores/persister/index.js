import { effect } from "@preact/signals-core";
export const persistSignal = (options) => {
    if (typeof window === "undefined") {
        return;
    }
    const { signal, key, shouldPersist = () => true } = options;
    return effect(() => {
        const value = signal.value;
        if (!shouldPersist(value)) {
            return;
        }
        try {
            window.localStorage.setItem(key, typeof value === "string" ? value : JSON.stringify(value));
        }
        catch { }
    });
};
export const restoreSignal = (options) => {
    if (typeof window === "undefined") {
        return;
    }
    const { signal, key, defaultValue, onRestore = (v) => v } = options;
    const value = window.localStorage.getItem(key);
    if (value !== null) {
        let parsedValue = value;
        try {
            parsedValue = JSON.parse(value);
        }
        catch { }
        signal.value = onRestore(parsedValue);
        return;
    }
    if ("defaultValue" in options) {
        signal.value = defaultValue;
    }
};
